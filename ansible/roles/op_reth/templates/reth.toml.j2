# =============================================================================
# reth.toml - op-reth Configuration
# =============================================================================
# Generated by Ansible - do not edit manually
# Batch size: {{ reth_batch_size }} blocks (optimized for ETA visibility)
# See docs/PERFORMANCE-TUNING.md for detailed explanations.
# =============================================================================

# -----------------------------------------------------------------------------
# Execution Stage Thresholds
# -----------------------------------------------------------------------------
# Controls when the execution stage commits a batch.
# Smaller batches = more frequent checkpoint updates = better ETA visibility
# Trade-off: ~10-15% slower total sync vs 500K default
#
# A batch commits when ANY threshold is hit:
#   - max_blocks: Maximum blocks per batch
#   - max_changes: Maximum state changes in memory
#   - max_cumulative_gas: Maximum cumulative gas processed
#   - max_duration: Maximum wall-clock time per batch
# -----------------------------------------------------------------------------
[stages.execution]
max_blocks = {{ reth_batch_size }}
max_changes = {{ (reth_batch_size | int * 10) }}
max_cumulative_gas = {{ (reth_batch_size | int * 30000000) }}
max_duration = "{{ reth_batch_duration }}"

# -----------------------------------------------------------------------------
# Hashing Stage Configuration
# -----------------------------------------------------------------------------
# AccountHashing and StorageHashing convert raw data to hashed format
# for efficient Merkle tree computation.
# -----------------------------------------------------------------------------
[stages.account_hashing]
clean_threshold = 500000
commit_threshold = 100000

[stages.storage_hashing]
clean_threshold = 500000
commit_threshold = 100000

# -----------------------------------------------------------------------------
# Merkle Stage Configuration
# -----------------------------------------------------------------------------
# MerkleExecute computes the state root from hashed data.
# incremental_threshold: Blocks before switching to incremental computation
# rebuild_threshold: Blocks before full trie rebuild
# -----------------------------------------------------------------------------
[stages.merkle]
incremental_threshold = 7000
rebuild_threshold = 100000

# -----------------------------------------------------------------------------
# Other Stages
# -----------------------------------------------------------------------------
[stages.sender_recovery]
commit_threshold = 5000000

[stages.transaction_lookup]
chunk_size = 5000000

[stages.index_account_history]
commit_threshold = 100000

[stages.index_storage_history]
commit_threshold = 100000

# -----------------------------------------------------------------------------
# ETL Configuration
# -----------------------------------------------------------------------------
# ETL (Extract, Transform, Load) is used for sorted database inserts.
# file_size: Maximum size before flush to disk (default: 500MB)
# -----------------------------------------------------------------------------
[stages.etl]
file_size = 524288000
