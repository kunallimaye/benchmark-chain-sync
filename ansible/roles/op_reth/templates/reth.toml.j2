# =============================================================================
# reth.toml - op-reth Configuration
# =============================================================================
# Generated by Ansible - do not edit manually
# All stage thresholds configured for visibility (default: 5000)
# See docs/PERFORMANCE-TUNING.md for detailed explanations.
# =============================================================================

# -----------------------------------------------------------------------------
# Execution Stage Thresholds
# -----------------------------------------------------------------------------
# Controls when the execution stage commits a batch.
# Smaller batches = more frequent checkpoint updates = better ETA visibility
# Trade-off: Slower total sync due to more frequent commits
#
# A batch commits when ANY threshold is hit:
#   - max_blocks: Maximum blocks per batch
#   - max_changes: Maximum state changes in memory
#   - max_cumulative_gas: Maximum cumulative gas processed
#   - max_duration: Maximum wall-clock time per batch
# -----------------------------------------------------------------------------
[stages.execution]
max_blocks = {{ reth_execution_max_blocks }}
max_changes = {{ reth_execution_max_changes }}
max_cumulative_gas = {{ reth_execution_max_cumulative_gas }}
max_duration = "{{ reth_execution_max_duration }}"

# -----------------------------------------------------------------------------
# Headers Stage Configuration
# -----------------------------------------------------------------------------
[stages.headers]
commit_threshold = {{ reth_headers_commit_threshold }}

# -----------------------------------------------------------------------------
# Sender Recovery Stage Configuration
# -----------------------------------------------------------------------------
[stages.sender_recovery]
commit_threshold = {{ reth_sender_recovery_commit_threshold }}

# -----------------------------------------------------------------------------
# Hashing Stage Configuration
# -----------------------------------------------------------------------------
# AccountHashing and StorageHashing convert raw data to hashed format
# for efficient Merkle tree computation.
# clean_threshold: Blocks before switching to full re-hash vs incremental
# commit_threshold: Entities processed before committing to database
# -----------------------------------------------------------------------------
[stages.account_hashing]
clean_threshold = {{ reth_account_hashing_clean_threshold }}
commit_threshold = {{ reth_account_hashing_commit_threshold }}

[stages.storage_hashing]
clean_threshold = {{ reth_storage_hashing_clean_threshold }}
commit_threshold = {{ reth_storage_hashing_commit_threshold }}

# -----------------------------------------------------------------------------
# Merkle Stage Configuration
# -----------------------------------------------------------------------------
# MerkleExecute computes the state root from hashed data.
# incremental_threshold: Blocks before switching to incremental computation
# rebuild_threshold: Blocks before full trie rebuild
# -----------------------------------------------------------------------------
[stages.merkle]
incremental_threshold = {{ reth_merkle_incremental_threshold }}
rebuild_threshold = {{ reth_merkle_rebuild_threshold }}

# -----------------------------------------------------------------------------
# Transaction Lookup Stage Configuration
# -----------------------------------------------------------------------------
[stages.transaction_lookup]
chunk_size = {{ reth_transaction_lookup_chunk_size }}

# -----------------------------------------------------------------------------
# Index History Stages Configuration
# -----------------------------------------------------------------------------
[stages.index_account_history]
commit_threshold = {{ reth_index_account_history_commit_threshold }}

[stages.index_storage_history]
commit_threshold = {{ reth_index_storage_history_commit_threshold }}

# -----------------------------------------------------------------------------
# Prune Stage Configuration
# -----------------------------------------------------------------------------
[stages.prune]
commit_threshold = {{ reth_prune_commit_threshold }}

# -----------------------------------------------------------------------------
# ETL Configuration
# -----------------------------------------------------------------------------
# ETL (Extract, Transform, Load) is used for sorted database inserts.
# file_size: Maximum size before flush to disk (default: 500MB)
# -----------------------------------------------------------------------------
[stages.etl]
file_size = {{ reth_etl_file_size }}
